# 功能规范：绩效数据报表

**版本:** 1.0  
**作者:** AI Assistant  
**日期:** 2025-12-28

---

## 概述

绩效数据报表功能是数据分析平台的核心业务功能之一，用于查询、筛选和展示员工的绩效数据。该功能支持灵活的时间范围查询、人员筛选和部门筛选，帮助管理层、人力资源管理人员和数据分析师快速获取所需的绩效数据，支持绩效分析和决策制定。

该功能的核心价值在于：

1. **灵活查询**：支持多种时间维度查询（年份、季度），满足不同分析需求
2. **智能筛选**：支持按人员、部门等多维度筛选，快速定位目标数据
3. **层级查询**：支持部门层级查询，可查询部门及其下级部门的绩效数据
4. **数据展示**：以报表形式清晰展示绩效数据，支持数据导出

该功能面向企业管理层、人力资源管理人员、数据分析师和业务人员，帮助他们快速获取绩效数据洞察，支持绩效评估和决策制定。

---

## 用户场景与测试

### 场景1：人力资源管理人员按年份查询绩效数据

**作为** 人力资源管理人员  
**我想要** 查询2025年全年的绩效数据  
**以便于** 进行年度绩效评估和总结

**验收标准：**

- [ ] 可以选择开始年份为2025，结束年份为2025
- [ ] 系统返回2025年1月1日至2025年12月31日的所有绩效数据
- [ ] 可以选择跨年查询，如2025~2023，系统返回三年的绩效数据
- [ ] 查询结果以报表形式展示，包含绩效记录的关键信息
- [ ] 查询响应时间不超过3秒（数据量在1万条以内）

### 场景2：数据分析师按季度查询绩效数据

**作为** 数据分析师  
**我想要** 查询2025年Q1到Q4的绩效数据  
**以便于** 分析季度绩效趋势

**验收标准：**

- [ ] 可以选择开始时间为2025年Q1，结束时间为2025年Q4
- [ ] 系统返回2025年Q1（1-3月）到Q4（10-12月）的所有绩效数据
- [ ] 可以选择跨年季度查询，如开始时间为2025年Q3，查询长度为3年，系统自动计算结束时间为2022年Q4
- [ ] 开始时间选择后，结束时间的季度自动推算，但可以手动调整
- [ ] 查询结果按季度分组展示，便于对比分析

### 场景3：部门经理查询本部门人员绩效

**作为** 部门经理  
**我想要** 查询本部门所有人员的绩效数据  
**以便于** 了解部门整体绩效情况

**验收标准：**

- [ ] 可以通过部门ID查询对应部门下所有人员的绩效数据
- [ ] 可以选择是否包含下级部门
- [ ] 如果选择不包含下级部门，只返回该部门直接下属人员的绩效数据
- [ ] 如果选择包含下级部门，返回该部门及其所有下级部门人员的绩效数据
- [ ] 查询结果按部门和人员分组展示

### 场景4：人力资源管理人员查询特定人员绩效

**作为** 人力资源管理人员  
**我想要** 查询多个特定人员的绩效数据  
**以便于** 进行人员绩效对比分析

**验收标准：**

- [ ] 可以通过人员UserId搜索，支持输入单个或多个UserId
- [ ] 支持多人员查询，可以同时查询多个人员的绩效数据
- [ ] 查询结果按人员分组展示，便于对比
- [ ] 支持人员搜索功能，可以通过姓名、工号等快速定位人员

### 场景5：数据分析师组合查询绩效数据

**作为** 数据分析师  
**我想要** 查询2025年Q1到Q3期间，A部门（包含下级部门）所有人员的绩效数据  
**以便于** 进行部门绩效深度分析

**验收标准：**

- [ ] 可以同时选择时间范围（2025年Q1~Q3）、部门（A部门）、包含下级部门选项
- [ ] 系统返回满足所有条件的绩效数据
- [ ] 查询结果可以按时间、部门、人员等维度进行分组和排序
- [ ] 支持将查询结果导出为Excel或CSV格式

---

## 功能需求

### FR1: 年份段滚动查询

**描述：** 支持根据年份段进行滚动查询，返回指定年份范围内的绩效数据。

**需求明细：**

1. **年份选择**
   - 提供开始年份和结束年份选择器
   - 支持选择同一年份（如2025~2025）查询单年数据
   - 支持选择跨年范围（如2025~2023）查询多年数据
   - 结束年份不能早于开始年份

2. **查询范围计算**
   - 单年查询（如2025~2025）：返回该年1月1日00:00:00至12月31日23:59:59的所有绩效数据
   - 多年查询（如2025~2023）：返回从2023年1月1日00:00:00至2025年12月31日23:59:59的所有绩效数据
   - 时间范围计算包含开始年份和结束年份的完整年度

3. **数据返回**
   - 返回符合时间范围内的所有绩效记录
   - 绩效记录按时间倒序排列（最新的在前）
   - 支持分页展示，每页默认20条，可调整

### FR2: 年份+季度滚动查询

**描述：** 支持根据年份和季度进行滚动查询，提供更精确的时间范围控制。

**需求明细：**

1. **季度选择**
   - 提供开始时间和结束时间选择器，每个时间包含年份和季度
   - 季度选项：Q1（1-3月）、Q2（4-6月）、Q3（7-9月）、Q4（10-12月）
   - 支持跨年季度查询（如2025年Q3到2022年Q4）

2. **智能季度推算**
   - 当用户选择开始时间的年份和季度后，系统自动推算结束时间的季度
   - 推算规则：基于开始时间和查询长度（年数）自动计算
   - 例如：开始时间为2025年Q3，查询长度为3年，则结束时间自动推算为2022年Q4
   - 推算公式：结束季度 = 开始季度，结束年份 = 开始年份 - 查询长度 + 1
   - 季度字段可以手动编辑调整，不受推算结果限制

3. **查询长度设置**
   - 提供查询长度选择器（单位：年）
   - 查询长度范围：1-10年
   - 选择查询长度后，自动更新结束时间的年份和季度
   - 用户仍可手动调整结束时间的年份和季度

4. **查询范围计算**
   - Q1：对应年份的1月1日00:00:00至3月31日23:59:59
   - Q2：对应年份的4月1日00:00:00至6月30日23:59:59
   - Q3：对应年份的7月1日00:00:00至9月30日23:59:59
   - Q4：对应年份的10月1日00:00:00至12月31日23:59:59
   - 跨年查询：从结束时间的季度开始日期至开始时间的季度结束日期

5. **数据返回**
   - 返回符合时间范围内的所有绩效记录
   - 绩效记录按时间倒序排列
   - 支持按季度分组展示

### FR3: 人员搜索查询

**描述：** 支持通过人员UserId查询对应人员的绩效数据，支持多人员查询。

**需求明细：**

1. **人员选择方式**
   - 支持通过UserId直接输入查询
   - 支持人员搜索功能，可以通过姓名、工号等关键词搜索人员
   - 支持多选，可以同时选择多个人员
   - 人员选择器支持搜索、筛选、分页
   - **使用虚拟列表（Virtual List）技术优化大量人员数据的展示性能**
   - **人员列表中需标识部门路径（如：A部门/B部门/C部门），便于用户识别人员所属部门层级**
   - 人员数据从人员表拉取，支持实时搜索查询

2. **多人员查询**
   - 可以同时查询多个人员的绩效数据
   - 查询参数支持传入多个UserId（数组格式）
   - 系统返回所有选中人员的绩效数据

3. **数据返回**
   - 返回符合人员条件的所有绩效记录
   - 绩效记录按人员分组展示
   - 支持按人员姓名、工号等排序

4. **与其他筛选条件组合**
   - 人员筛选可以与其他筛选条件（时间范围、部门等）组合使用
   - 组合查询时，返回同时满足所有条件的绩效数据

### FR4: 部门搜索查询

**描述：** 支持通过部门ID查询对应部门下所有人员的绩效数据。

**需求明细：**

1. **部门选择方式**
   - 支持通过部门ID直接查询
   - 支持部门搜索功能，可以通过部门名称等关键词搜索部门
   - **使用部门组织树（Organization Tree）组件进行可视化选择**
   - 部门选择器支持搜索、筛选
   - **支持勾选"包含下级组织"选项，控制是否查询下级部门的绩效数据**
   - 组织树支持展开/折叠，显示层级关系

2. **部门人员查询**
   - 查询指定部门ID下所有人员的绩效数据
   - 返回该部门直接下属的所有人员（不包括下级部门人员）
   - 查询参数：部门ID（单个）

3. **数据返回**
   - 返回符合部门条件的所有绩效记录
   - 绩效记录按部门和人员分组展示
   - 支持按部门名称、人员姓名等排序

4. **与其他筛选条件组合**
   - 部门筛选可以与其他筛选条件（时间范围、人员等）组合使用
   - 组合查询时，返回同时满足所有条件的绩效数据

### FR5: 部门下级部门查询

**描述：** 支持查询部门及其下级部门的绩效数据，提供层级查询能力。

**需求明细：**

1. **包含下级部门选项**
   - 提供"包含下级部门"复选框选项
   - 默认不包含下级部门（仅查询指定部门）
   - 用户可以选择包含下级部门

2. **查询逻辑**
   - **不包含下级部门**：只查询指定部门直接下属人员的绩效数据
     - 例如：查询A部门，不传入包含下级，则只返回A部门直接下属人员的绩效数据
   - **包含下级部门**：查询指定部门及其所有下级部门人员的绩效数据
     - 例如：查询A部门，传入包含下级，则返回A部门、B部门（A的下级）、C部门（B的下级）等所有相关部门的绩效数据
   - 部门层级关系通过部门树结构确定

3. **部门层级计算**
   - 系统根据部门树结构递归查找所有下级部门
   - 包括直接下级部门和间接下级部门（多级嵌套）
   - 查询参数：部门ID（单个）、包含下级（布尔值）

4. **数据返回**
   - 返回符合部门条件的所有绩效记录
   - 绩效记录按部门层级分组展示（部门、子部门、人员）
   - 支持展开/折叠部门层级查看
   - 支持按部门层级、人员姓名等排序

5. **性能优化**
   - 对于深层级部门树，采用递归查询优化
   - 支持查询结果缓存（缓存时间5分钟）
   - 大数据量查询支持分页和懒加载

---

## 成功标准

### 业务成果

1. **查询准确性**
   - 年份段查询的时间范围计算准确率达到100%
   - 季度查询的时间范围计算准确率达到100%
   - 部门层级查询的部门范围计算准确率达到100%
   - 人员查询的结果准确率达到100%

2. **查询性能**
   - 单年数据查询（1万条以内）响应时间不超过3秒
   - 多年数据查询（5万条以内）响应时间不超过10秒
   - 部门层级查询（包含10个下级部门）响应时间不超过5秒
   - 多人员查询（100人以内）响应时间不超过5秒

3. **系统可用性**
   - 绩效数据报表功能的可用性达到99%以上
   - 查询操作成功率不低于99.5%
   - 页面加载时间不超过2秒

4. **用户体验**
   - 新用户无需培训即可完成基本的查询操作
   - 季度智能推算功能的准确率达到100%
   - 查询结果展示清晰，支持快速定位目标数据
   - 支持查询条件保存和快速复用

### 用户体验

1. **易用性**
   - 时间选择器操作直观，支持快速选择常见时间范围
   - 季度智能推算功能减少用户操作步骤，提升效率
   - 人员搜索支持模糊匹配，快速定位目标人员
   - 部门选择器支持树形展示，层级关系清晰

2. **灵活性**
   - 支持多种查询条件组合，满足不同分析需求
   - 查询结果支持多种排序和分组方式
   - 支持查询结果导出，便于进一步分析

3. **可维护性**
   - 查询逻辑清晰，便于后续扩展
   - 查询参数标准化，便于API调用
   - 提供完整的查询日志，便于问题排查

---

## 关键实体

### 绩效数据查询参数（PerformanceQueryParams）

- **用途：** 定义绩效数据查询的所有参数
- **关键属性：**
  - 开始年份（可选）
  - 结束年份（可选）
  - 开始时间（年份+季度，可选）
  - 结束时间（年份+季度，可选）
  - 查询长度（年数，可选）
  - 人员UserId列表（可选，数组）
  - 部门ID（可选）
  - 包含下级部门（布尔值，默认false）
  - 分页参数（页码、每页条数）

### 绩效数据记录（PerformanceRecord）

- **用途：** 存储单条绩效数据记录
- **关键属性：**
  - 绩效记录ID（主键）
  - 员工ID（外键关联用户）
  - 员工姓名
  - 员工工号
  - 部门ID（外键关联部门）
  - 部门名称
  - 绩效周期（年份、季度）
  - 绩效指标名称
  - 绩效指标值
  - 绩效评分
  - 评价人ID
  - 评价时间
  - 绩效状态
  - 备注信息

### 部门层级关系（DepartmentHierarchy）

- **用途：** 定义部门的层级关系，支持下级部门查询
- **关键属性：**
  - 部门ID（主键）
  - 部门名称
  - 父部门ID（外键，可为空）
  - 部门层级（数字，根部门为1）
  - 部门路径（字符串，如"A/B/C"）
  - 子部门列表（递归结构）

---

## 假设与依赖

### 假设

1. **数据基础**
   - 绩效数据已通过数据同步功能同步到平台
   - 绩效数据包含完整的员工ID、部门ID、时间信息
   - 部门层级关系数据完整且准确
   - 人员基础信息（姓名、工号等）已同步

2. **用户访问**
   - 用户通过企业内网或VPN访问平台
   - 用户已通过企业统一认证系统完成身份验证
   - 不同角色用户具有相应的数据访问权限

3. **数据规模**
   - 单次查询的绩效记录数量不超过10万条
   - 部门层级深度不超过10级
   - 单个部门下的人员数量不超过5000人
   - 同时在线查询用户不超过100人

4. **时间范围**
   - 支持查询最近10年的绩效数据
   - 季度查询支持跨年查询，最多跨10年
   - 时间范围选择器支持年份范围：2015-2030

### 依赖

1. **外部系统**
   - 依赖绩效数据同步功能提供的数据
   - 依赖用户管理功能提供的人员基础信息
   - 依赖组织架构管理功能提供的部门层级关系

2. **基础设施**
   - 依赖数据库系统存储和查询绩效数据
   - 依赖前端框架提供用户界面组件
   - 依赖后端API提供查询服务

3. **权限要求**
   - 需要获得绩效数据的读取权限
   - 需要获得人员信息的读取权限
   - 需要获得部门信息的读取权限
   - 不同角色用户具有不同的数据访问范围

---

## 边界与范围

### 包含的功能

- ✅ 年份段滚动查询（单年、多年）
- ✅ 年份+季度滚动查询（支持跨年）
- ✅ 季度智能推算功能
- ✅ 人员搜索和查询（支持多人员）
- ✅ 部门搜索和查询
- ✅ 部门下级部门查询（支持层级查询）
- ✅ 查询条件组合查询
- ✅ 查询结果展示和分页
- ✅ 查询结果导出（Excel/CSV）
- ✅ **批量导出功能（支持导出当前查询结果，即当前分页的数据）**
- ✅ **全量导出功能（支持导出所有符合条件的数据，不受分页限制）**
- ✅ **分页功能（支持服务端分页，可调整每页条数）**

### 不包含的功能

- ❌ 绩效数据的可视化图表展示（由其他功能模块提供）
- ❌ 绩效数据的统计分析计算（仅负责数据查询和展示）
- ❌ 绩效数据的编辑和修改（数据以源系统为准）
- ❌ 绩效数据的实时推送（采用查询方式获取）
- ❌ 自定义查询模板保存（当前版本不支持）
- ❌ 查询结果的二次计算和聚合（仅展示原始数据）

---

## 风险与缓解

### 风险1：大数据量查询性能问题

**影响：** 多年数据或大部门查询可能导致响应时间过长，影响用户体验

**缓解措施：**

- 实现查询结果分页，避免一次性加载大量数据
- 对常用查询条件建立索引，提升查询速度
- 实现查询结果缓存机制，减少重复查询
- 对大数据量查询提供进度提示和异步处理
- 限制单次查询的最大数据量（如10万条）

### 风险2：部门层级查询复杂度高

**影响：** 深层级部门树查询可能导致性能问题和逻辑错误

**缓解措施：**

- 优化部门层级查询算法，使用递归或迭代方式
- 对部门层级关系建立缓存，减少重复计算
- 限制部门层级查询的最大深度（如10级）
- 提供查询超时机制，避免长时间等待
- 对部门层级查询结果进行验证，确保准确性

### 风险3：季度智能推算逻辑错误

**影响：** 季度推算错误可能导致查询时间范围不准确

**缓解措施：**

- 详细设计季度推算算法，覆盖各种边界情况
- 对季度推算结果进行验证和测试
- 允许用户手动调整推算结果，提供灵活性
- 提供推算逻辑的说明文档，便于用户理解
- 记录推算过程日志，便于问题排查

### 风险4：多条件组合查询复杂度高

**影响：** 多个筛选条件组合可能导致查询逻辑复杂，容易出错

**缓解措施：**

- 标准化查询参数，统一处理逻辑
- 对组合查询进行充分测试，覆盖各种组合场景
- 提供查询条件的验证机制，避免无效组合
- 优化查询性能，提升组合查询响应速度
- 提供查询条件的预览功能，便于用户确认

---

## 未来扩展

以下功能不在当前版本范围内，但可能在未来版本中考虑：

1. **查询模板保存**：支持保存常用查询条件为模板，快速复用
2. **高级筛选条件**：支持绩效评分范围、绩效状态等更多筛选条件
3. **查询结果对比**：支持多个查询结果的对比分析
4. **自定义报表**：支持用户自定义报表格式和字段
5. **数据可视化**：集成图表展示功能，支持绩效数据可视化
6. **查询历史记录**：记录用户的查询历史，支持快速回看
7. **批量导出**：支持批量导出多个查询结果
8. **查询权限控制**：支持更细粒度的数据访问权限控制

---

## 需要澄清的问题

此规范已基于常见企业数据平台的标准实践做出合理假设。所有功能需求均已明确，无需进一步澄清即可进入计划阶段。
